<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weekly Schedule</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#34495e">
  <link rel="icon" href="icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="icon-512.png">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #2c3e50; }
    .now { background: #f1c40f; padding: 10px; margin-bottom: 20px; font-size: 1.2em; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #34495e; color: white; }
    tr:nth-child(even) { background: #f9f9f9; }
  </style>
</head>
<body>
  <h1>My Weekly Schedule</h1>
  <div id="currentTask" class="now">Loading current task...</div>

  <h2>Today's Schedule (<span id="todayName"></span>)</h2>
  <table id="todaySchedule">
    <tr><th>Time</th><th>Activity</th></tr>
    <!-- Today's schedule rows will be inserted here -->
  </table>

  <h2>Weekly Schedule</h2>
  <table id="weeklySchedule">
    <tr><th>Day</th><th>Time</th><th>Activity</th></tr>
    <!-- Weekly schedule rows will be inserted by JS -->
  </table>

  <script>
    const schedule = {
      "Sunday": [
        { start: "18:00", end: "08:00", task: "ðŸŒ™ Night shift (Satâ€“Sun)" },
        { start: "08:30", end: "15:00", task: "ðŸ˜´ Sleep" },
        { start: "15:00", end: "17:30", task: "â˜€ï¸ Free hours" },
        { start: "17:30", end: "18:00", task: "ðŸ´ Dinner / commute" },
        { start: "18:00", end: "06:00", task: "ðŸŒ™ Night shift (Sunâ€“Mon)" }
      ],
      "Monday": [
        { start: "06:00", end: "08:15", task: "ðŸŒ™ Sleep" },
        { start: "08:15", end: "08:50", task: "ðŸ´ Breakfast / prep" },
        { start: "09:05", end: "09:55", task: "ðŸŽ“ MATH 430 (class)" },
        { start: "10:15", end: "14:15", task: "ðŸ˜´ Sleep" },
        { start: "14:30", end: "15:30", task: "ðŸ“š Study MATH 430" },
        { start: "15:30", end: "17:15", task: "ðŸ´ Meal / relax" },
        { start: "17:15", end: "17:50", task: "ðŸ“‹ Work prep" },
        { start: "18:00", end: "06:00", task: "ðŸŒ™ Night shift (Monâ€“Tue)" }
      ],
      "Tuesday": [
        { start: "06:00", end: "12:30", task: "ðŸŒ™ Sleep" },
        { start: "12:30", end: "13:15", task: "ðŸ´ Lunch / prep" },
        { start: "13:35", end: "14:50", task: "ðŸŽ“ CMPSC 472 (class)" },
        { start: "15:05", end: "16:05", task: "ðŸ“š Study CMPSC 472" },
        { start: "16:15", end: "17:00", task: "ðŸ“š Study CMPSC 463" },
        { start: "17:00", end: "17:45", task: "ðŸ´ Dinner" },
        { start: "18:00", end: "21:00", task: "âš ï¸ CMPSC 463 (class, overlaps night shift)" },
        { start: "18:00", end: "06:00", task: "ðŸŒ™ Night shift (Tueâ€“Wed)" }
      ],
      "Wednesday": [
        { start: "06:00", end: "08:15", task: "ðŸŒ™ Sleep" },
        { start: "08:15", end: "08:50", task: "ðŸ´ Breakfast / prep" },
        { start: "09:05", end: "09:55", task: "ðŸŽ“ MATH 430 (class)" },
        { start: "10:15", end: "14:15", task: "ðŸ˜´ Sleep" },
        { start: "14:30", end: "15:30", task: "ðŸ‹ï¸ Gym" },
        { start: "15:45", end: "17:15", task: "ðŸ´ Dinner" },
        { start: "18:00", end: "21:00", task: "ðŸŽ“ CMPSC 313 (class)" },
        { start: "22:30", end: "06:30", task: "ðŸŒ™ Sleep (Wedâ€“Thu)" }
      ],
      "Thursday": [
        { start: "00:00", end: "12:00", task: "ðŸŒ™ Sleep in / light start" },
        { start: "13:35", end: "14:50", task: "ðŸŽ“ CMPSC 472 (class)" },
        { start: "15:05", end: "16:05", task: "ðŸ“š Study CMPSC 472" },
        { start: "17:00", end: "18:00", task: "ðŸ´ Dinner" },
        { start: "18:30", end: "19:30", task: "ðŸ‹ï¸ Gym" },
        { start: "23:00", end: "06:30", task: "ðŸŒ™ Sleep (Thuâ€“Fri)" }
      ],
      "Friday": [
        { start: "09:05", end: "09:55", task: "ðŸŽ“ MATH 430 (class)" },
        { start: "10:15", end: "11:15", task: "ðŸ“š Study MATH 430" },
        { start: "11:30", end: "12:30", task: "ðŸ´ Lunch" },
        { start: "12:45", end: "13:45", task: "ðŸ‹ï¸ Gym" },
        { start: "13:45", end: "23:00", task: "â˜€ï¸ Free hours" }
      ],
      "Saturday": [
        { start: "08:00", end: "17:00", task: "â˜€ï¸ Free hours" },
        { start: "17:00", end: "17:45", task: "ðŸ´ Dinner / commute" },
        { start: "18:00", end: "08:00", task: "ðŸŒ™ Night shift (Satâ€“Sun)" }
      ]
    };

    function updateTask() {
      const now = new Date();
      const day = now.toLocaleString('en-US', { weekday: 'long' });
      const currentTime = now.getHours() * 60 + now.getMinutes();

      let currentTask = "Free / Rest time";
      if (schedule[day]) {
        for (let slot of schedule[day]) {
          let [sh, sm] = slot.start.split(":").map(Number);
          let [eh, em] = slot.end.split(":").map(Number);
          let startM = sh * 60 + sm;
          let endM = eh * 60 + em;
          if (currentTime >= startM && currentTime < endM) {
            currentTask = slot.task;
            break;
          }
        }
      }
      document.getElementById("currentTask").innerText = 
        "ðŸ‘‰ Right now: " + currentTask;
    }

    // Render today's schedule
    function renderTodaySchedule() {
      const now = new Date();
      const day = now.toLocaleString('en-US', { weekday: 'long' });
      document.getElementById('todayName').innerText = day;
      const table = document.getElementById('todaySchedule');
      // Remove old rows except header
      while (table.rows.length > 1) table.deleteRow(1);
      if (schedule[day]) {
        for (let slot of schedule[day]) {
          let row = table.insertRow();
          let timeCell = row.insertCell();
          let activityCell = row.insertCell();
          // Format time as HH:MM â€“ HH:MM
          let start = slot.start;
          let end = slot.end;
          timeCell.innerText = `${formatTime(start)} â€“ ${formatTime(end)}`;
          activityCell.innerText = slot.task;
        }
      } else {
        let row = table.insertRow();
        let cell = row.insertCell();
        cell.colSpan = 2;
        cell.innerText = 'No schedule for today.';
      }
    }

    // Render weekly schedule
    function renderWeeklySchedule() {
      const table = document.getElementById('weeklySchedule');
      // Remove old rows except header
      while (table.rows.length > 1) table.deleteRow(1);
      for (let day in schedule) {
        for (let slot of schedule[day]) {
          let row = table.insertRow();
          let dayCell = row.insertCell();
          let timeCell = row.insertCell();
          let activityCell = row.insertCell();
          dayCell.innerText = day;
          timeCell.innerText = `${formatTime(slot.start)} â€“ ${formatTime(slot.end)}`;
          activityCell.innerText = slot.task;
        }
      }
    }

    // Helper to format time as HH:MM AM/PM
    function formatTime(timeStr) {
      let [h, m] = timeStr.split(":").map(Number);
      let ampm = h >= 12 ? 'PM' : 'AM';
      let hour = h % 12;
      if (hour === 0) hour = 12;
      return `${hour}:${m.toString().padStart(2, '0')} ${ampm}`;
    }

    updateTask();
    renderTodaySchedule();
    renderWeeklySchedule();
    setInterval(() => {
      updateTask();
      renderTodaySchedule();
    }, 60000);

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('service-worker.js')
          .then(function(registration) {
            console.log('ServiceWorker registration successful:', registration.scope);
          }, function(err) {
            console.log('ServiceWorker registration failed:', err);
          });
      });
    }
  </script>
</body>
</html>