<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weekly Schedule</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#34495e">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4c5.png" sizes="192x192">
  <link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4c5.png">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #2c3e50; }
    .now { background: #f1c40f; padding: 10px; margin-bottom: 20px; font-size: 1.2em; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #34495e; color: white; }
    tr:nth-child(even) { background: #f9f9f9; }
  </style>
</head>
<body>
  <h2>Custom Additions for Today (<span id="customTodayName"></span>)</h2>
  <table id="customSchedule">
    <tr><th>Time</th><th>Activity</th><th>Action</th></tr>
    <!-- Custom schedule rows will be inserted here -->
  </table>
  <form id="addCustomForm" style="margin-bottom:20px;">
    <label>
      Time:
      <input type="time" id="customTime" required>
    </label>
    <label>
      Activity:
      <input type="text" id="customActivity" required>
    </label>
    <button type="submit">Add to Today's Schedule</button>
  </form>
  <h1>My Weekly Schedule</h1>
  <div id="currentTask" class="now">Loading current task...</div>
  <div id="comingUp" class="now" style="background:#e1eafc; color:#34495e; margin-bottom:20px;">Loading next activity...</div>

  <h2>Today's Schedule (<span id="todayName"></span>)</h2>
  <table id="todaySchedule">
    <tr><th>Time</th><th>Activity</th></tr>
    <!-- Today's schedule rows will be inserted here -->
  </table>

  <h2>Weekly Schedule</h2>
  <table id="weeklySchedule">
    <tr><th>Day</th><th>Time</th><th>Activity</th></tr>
    <!-- Weekly schedule rows will be inserted by JS -->
  </table>

  <script>
    // Store custom schedule items in memory only (temporary)
    const customScheduleMemory = {};
    function getCustomItems(day) {
      return customScheduleMemory[day] || [];
    }
    function setCustomItems(day, items) {
      customScheduleMemory[day] = items;
    }

    // Render custom schedule for today
    function renderCustomSchedule() {
      const now = new Date();
      const day = now.toLocaleString('en-US', { weekday: 'long' });
      document.getElementById('customTodayName').innerText = day;
      const table = document.getElementById('customSchedule');
      while (table.rows.length > 1) table.deleteRow(1);
      const items = getCustomItems(day);
      if (items.length === 0) {
        let row = table.insertRow();
        let cell = row.insertCell();
        cell.colSpan = 3;
        cell.innerText = 'No custom additions for today.';
      } else {
        items.forEach((item, idx) => {
          let row = table.insertRow();
          let timeCell = row.insertCell();
          let activityCell = row.insertCell();
          let actionCell = row.insertCell();
          timeCell.innerText = formatTime(item.time);
          activityCell.innerText = item.activity;
          let delBtn = document.createElement('button');
          delBtn.innerText = 'Delete';
          delBtn.onclick = function() {
            items.splice(idx, 1);
            setCustomItems(day, items);
            renderCustomSchedule();
          };
          actionCell.appendChild(delBtn);
        });
      }
    }

    // Handle add custom form
    document.getElementById('addCustomForm').onsubmit = function(e) {
      e.preventDefault();
      const now = new Date();
      const day = now.toLocaleString('en-US', { weekday: 'long' });
      const time = document.getElementById('customTime').value;
      const activity = document.getElementById('customActivity').value;
      if (!time || !activity) return;
      let items = getCustomItems(day);
      items.push({ time, activity });
      setCustomItems(day, items);
      renderCustomSchedule();
      document.getElementById('addCustomForm').reset();
    };
const schedule = {
"Sunday": [
{ start: "06:00", end: "08:00", task: "ğŸŒ™ Night shift (Sat â†’ Sun)" },
{ start: "08:30", end: "15:00", task: "ğŸ˜´ Sleep" },
{ start: "15:00", end: "17:30", task: "â˜€ï¸ Free hours" },
{ start: "17:30", end: "18:00", task: "ğŸ´ Dinner / prep" },
{ start: "18:00", end: "24:00", task: "ğŸŒ™ Night shift" }
],
"Monday": [
{ start: "06:00", end: "08:15", task: "ğŸ˜´ Sleep" },
{ start: "08:15", end: "08:50", task: "ğŸ³ Breakfast / prep" },
{ start: "09:05", end: "09:55", task: "ğŸ“ MATH 430 (class)" },
{ start: "10:15", end: "14:00", task: "ğŸ˜´ Sleep / rest" },
{ start: "14:30", end: "15:45", task: "ğŸ“ CMPSC 463 (class)" },
{ start: "16:00", end: "17:15", task: "ğŸ´ Dinner / prep" },
{ start: "18:00", end: "24:00", task: "ğŸŒ™ Night shift" }
],
"Tuesday": [
{ start: "06:00", end: "12:30", task: "ğŸ˜´ Sleep" },
{ start: "12:30", end: "13:15", task: "ğŸ² Lunch / prep" },
{ start: "13:35", end: "14:50", task: "ğŸ“ CMPSC 472 (class)" },
{ start: "15:05", end: "16:05", task: "ğŸ“š Study CMPSC 472" },
{ start: "17:00", end: "17:45", task: "ğŸ´ Dinner" },
{ start: "18:00", end: "24:00", task: "ğŸŒ™ Night shift" }
],
"Wednesday": [
{ start: "06:00", end: "08:15", task: "ğŸ˜´ Sleep" },
{ start: "08:15", end: "08:50", task: "ğŸ³ Breakfast / prep" },
{ start: "09:05", end: "09:55", task: "ğŸ“ MATH 430 (class)" },
{ start: "10:15", end: "14:00", task: "ğŸ˜´ Sleep / rest" },
{ start: "14:30", end: "15:45", task: "ğŸ“ CMPSC 463 (class)" },
{ start: "16:00", end: "17:30", task: "ğŸ´ Dinner / relax" },
{ start: "18:00", end: "21:00", task: "ğŸ“ CMPSC 313 (class)" },
{ start: "22:30", end: "06:30", task: "ğŸ˜´ Sleep (overnight)" }
],
"Thursday": [
{ start: "09:00", end: "12:30", task: "ğŸ˜´ Sleep in / rest" },
{ start: "12:30", end: "13:15", task: "ğŸ² Lunch / prep" },
{ start: "13:35", end: "14:50", task: "ğŸ“ CMPSC 472 (class)" },
{ start: "15:05", end: "16:05", task: "ğŸ“š Study CMPSC 472" },
{ start: "17:00", end: "18:00", task: "ğŸ´ Dinner" },
{ start: "18:30", end: "19:30", task: "ğŸ‹ï¸ Gym" },
{ start: "23:00", end: "06:30", task: "ğŸ˜´ Sleep (overnight)" }
],
"Friday": [
{ start: "09:05", end: "09:55", task: "ğŸ“ MATH 430 (class)" },
{ start: "10:15", end: "11:15", task: "ğŸ“š Study MATH 430" },
{ start: "11:30", end: "12:30", task: "ğŸ² Lunch" },
{ start: "12:45", end: "13:45", task: "ğŸ‹ï¸ Gym" },
{ start: "14:00", end: "24:00", task: "â˜€ï¸ Free hours" }
],
"Saturday": [
{ start: "00:00", end: "08:00", task: "ğŸŒ™ Night shift (Fri â†’ Sat)" },
{ start: "08:30", end: "17:00", task: "â˜€ï¸ Free hours" },
{ start: "17:00", end: "17:45", task: "ğŸ´ Dinner / prep" },
{ start: "18:00", end: "24:00", task: "ğŸŒ™ Night shift" }
]
};
    function updateTask() {
      const now = new Date();
      const day = now.toLocaleString('en-US', { weekday: 'long' });
      const currentTime = now.getHours() * 60 + now.getMinutes();
      let currentTask = "Free / Rest time";
      let comingUp = "No more activities today.";
      let foundCurrent = false;
      let foundNext = false;
      if (schedule[day]) {
        for (let i = 0; i < schedule[day].length; i++) {
          let slot = schedule[day][i];
          let [sh, sm] = slot.start.split(":").map(Number);
          let [eh, em] = slot.end.split(":").map(Number);
          let startM = sh * 60 + sm;
          let endM = eh * 60 + em;
          // Handle overnight slots (end < start)
          if (endM <= startM) {
            if (currentTime >= startM || currentTime < endM) {
              currentTask = slot.task;
              foundCurrent = true;
              // Next activity is the next slot after this one
              if (i + 1 < schedule[day].length) {
                let nextSlot = schedule[day][i + 1];
                comingUp = `${formatTime(nextSlot.start)} â€“ ${formatTime(nextSlot.end)}: ${nextSlot.task}`;
                foundNext = true;
              }
              break;
            }
          } else {
            if (currentTime >= startM && currentTime < endM) {
              currentTask = slot.task;
              foundCurrent = true;
              // Next activity is the next slot after this one
              if (i + 1 < schedule[day].length) {
                let nextSlot = schedule[day][i + 1];
                comingUp = `${formatTime(nextSlot.start)} â€“ ${formatTime(nextSlot.end)}: ${nextSlot.task}`;
                foundNext = true;
              }
              break;
            }
          }
        }
        // If not found, find the next slot for today
        if (!foundCurrent) {
          for (let slot of schedule[day]) {
            let [sh, sm] = slot.start.split(":").map(Number);
            let startM = sh * 60 + sm;
            let [eh, em] = slot.end.split(":").map(Number);
            let endM = eh * 60 + em;
            if ((endM > startM && currentTime < startM) || (endM <= startM && currentTime < startM && currentTime < endM)) {
              comingUp = `${formatTime(slot.start)} â€“ ${formatTime(slot.end)}: ${slot.task}`;
              foundNext = true;
              break;
            }
          }
        }
      }
      document.getElementById("currentTask").innerText = `ğŸ‘‰ Right now: ${currentTask}`;
      document.getElementById("comingUp").innerText = foundNext ? `â­ï¸ Coming up: ${comingUp}` : "â­ï¸ No more activities today.";
    }

    // Render today's schedule
    function renderTodaySchedule() {
      const now = new Date();
      const day = now.toLocaleString('en-US', { weekday: 'long' });
      document.getElementById('todayName').innerText = day;
      const table = document.getElementById('todaySchedule');
      // Remove old rows except header
      while (table.rows.length > 1) table.deleteRow(1);
      if (schedule[day]) {
        for (let slot of schedule[day]) {
          let row = table.insertRow();
          let timeCell = row.insertCell();
          let activityCell = row.insertCell();
          // Format time as HH:MM â€“ HH:MM
          let start = slot.start;
          let end = slot.end;
          timeCell.innerText = `${formatTime(start)} â€“ ${formatTime(end)}`;
          activityCell.innerText = slot.task;
        }
      } else {
        let row = table.insertRow();
        let cell = row.insertCell();
        cell.colSpan = 2;
        cell.innerText = 'No schedule for today.';
      }
    }

    // Render weekly schedule
    function renderWeeklySchedule() {
      const table = document.getElementById('weeklySchedule');
      // Remove old rows except header
      while (table.rows.length > 1) table.deleteRow(1);
      for (let day in schedule) {
        for (let slot of schedule[day]) {
          let row = table.insertRow();
          let dayCell = row.insertCell();
          let timeCell = row.insertCell();
          let activityCell = row.insertCell();
          dayCell.innerText = day;
          timeCell.innerText = `${formatTime(slot.start)} â€“ ${formatTime(slot.end)}`;
          activityCell.innerText = slot.task;
        }
      }
    }

    // Helper to format time as HH:MM AM/PM
    function formatTime(timeStr) {
      let [h, m] = timeStr.split(":").map(Number);
      let ampm = h >= 12 ? 'PM' : 'AM';
      let hour = h % 12;
      if (hour === 0) hour = 12;
      return `${hour}:${m.toString().padStart(2, '0')} ${ampm}`;
    }

    updateTask();
    renderTodaySchedule();
    renderWeeklySchedule();
    renderCustomSchedule();
    setInterval(() => {
      updateTask();
      renderTodaySchedule();
      renderCustomSchedule();
    }, 60000);

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('service-worker.js')
          .then(function(registration) {
            console.log('ServiceWorker registration successful:', registration.scope);
          }, function(err) {
            console.log('ServiceWorker registration failed:', err);
          });
      });
    }
  </script>
</body>
</html>
